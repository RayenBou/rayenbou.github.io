"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[114],{8502:e=>{e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"une-api-cpanel-utilisable-meme-en-acces-user","metadata":{"permalink":"/fr/blog/une-api-cpanel-utilisable-meme-en-acces-user","source":"@site/blog/02/hebergement-cpanel-uapi/index.md","title":"Cpanel - Une api utilisable m\xeame en acc\xe8s user","description":"Est-il possible de cr\xe9er un sous-domaine directement depuis une application PHP/Symfony sans l\'acc\xe8s Root au serveur ?","date":"2024-07-10T15:28:41.853Z","tags":[{"inline":false,"label":"hebergement","permalink":"/fr/blog/tags/hebergement","description":"hebergement tag description"},{"inline":false,"label":"cpanel","permalink":"/fr/blog/tags/cpanel","description":"cpanel tag description"},{"inline":false,"label":"symfony","permalink":"/fr/blog/tags/symfony","description":"symfony tag description"}],"readingTime":8.835,"hasTruncateMarker":false,"authors":[{"name":"Boumaza Rayen","title":"D\xe9veloppeur PHP/Symfony | Formateur Passionn\xe9 | Geek \xe0 Plein Temps","url":"https://github.com/RayenBou","imageURL":"https://github.com/RayenBou.png","key":"rayen"}],"frontMatter":{"slug":"une-api-cpanel-utilisable-meme-en-acces-user","title":"Cpanel - Une api utilisable m\xeame en acc\xe8s user","authors":"rayen","tags":["hebergement","cpanel","symfony"]},"unlisted":false,"nextItem":{"title":"Upload de fichier - Public ou non public sur Symfony ?","permalink":"/fr/blog/upload-de-fichier-public-ou-non-public-symfony"}},"content":"### ***Est-il possible de cr\xe9er un sous-domaine directement depuis une application PHP/Symfony sans l\'acc\xe8s Root au serveur ?***\\r\\n\\r\\nLa r\xe9ponse est oui !\\r\\n\\r\\nJ\'ai eu envie de cr\xe9er un syst\xe8me de staging il y a quelque temps pour plusieurs raisons :\\r\\n\\r\\n- Montrer aux clients l\'avancement de leurs projets de mani\xe8re rapide tout en restant sur mon h\xe9bergement.\\r\\n- Par flemme de passer \xe0 chaque fois par un terminal (j\'aimerais tout faire en un clic).\\r\\n- Cr\xe9er un syst\xe8me de blog gratuit format CMS dont la mise en production est enti\xe8rement automatis\xe9e par la suite.\\r\\n\\\\\\r\\n\\r\\nLa contrainte principale a \xe9t\xe9 de ne pas c\xe9der \xe0 la facilit\xe9 car une fonctionnalit\xe9 comme celle-ci est bien plus facile sur un serveur priv\xe9 que sur un mutualis\xe9 sans acc\xe8s root.\\r\\n\\\\\\r\\n\\\\\\r\\n**Par chance, sur mon h\xe9bergement, il y a Cpanel d\'install\xe9 !**\\r\\n\\r\\nNon seulement Cpanel poss\xe8de une API permettant quasiment toutes les actions permises sur l\'interface qu\'on a l\'habitude de voir, mais elle est \xe9galement \xe9crite en Perl **ET PHP**.\\r\\n\\r\\n-------\\r\\n\\\\\\r\\n![Cpanel Delete Email](./img/cpanel.png)\\r\\n\\\\\\r\\nPar exemple, la suppression d\'un compte mail equivaux \xe0:\\r\\n\\r\\n```bash\\r\\nuapi --output=jsonpretty \\\\\\r\\n  --user=username \\\\\\r\\n  Email \\\\\\r\\n  delete_pop \\\\\\r\\n  email=\'user@domain.com\'\\r\\n  ```\\r\\n\\r\\n## ***Cr\xe9ation d\'un sous-domaine***\\r\\n\\r\\nMais ce qui nous intereresse, c\'est surtout [La cr\xe9ation d\'un sous domaine](https://api.docs.cpanel.net/openapi/cpanel/operation/addsubdomain/) !\\r\\n\\r\\n```bash\\r\\nuapi --output=jsonpretty \\\\\\r\\n  --user=username \\\\\\r\\n  SubDomain \\\\\\r\\n  addsubdomain \\\\\\r\\n  domain=\'subdomain\' \\\\\\r\\n  rootdomain=\'example.com\'\\r\\n```\\r\\n\\r\\nEt la documentation est tr\xe8s pratique car elle nous offre directement le code PHP \xe0 int\xe9grer au projet.\\r\\n\\r\\n```php\\r\\n//--------------------------------------------------------------------------------------\\r\\n// Instructions:\\r\\n//--------------------------------------------------------------------------------------\\r\\n// <theme-name> is the theme assigned to cPanel account.\\r\\n// 1) cd /usr/local/cpanel/base/frontend/<theme_name>\\r\\n// 2) mkdir api_examples\\r\\n// 3) cd api_examples\\r\\n// 4) create a file SubDomain_addsubdomain.live.php and put this code into that file.\\r\\n// 5) In your browser login to a cPanel account.\\r\\n// 6) Manually change the url from: .../frontend/<theme_name>/\\r\\n//    to .../frontend/<theme_name>/api_examples/SubDomain_addsubdomain.live.php\\r\\n//--------------------------------------------------------------------------------------\\r\\n\\r\\n// Instantiate the CPANEL object.\\r\\nrequire_once \\"/usr/local/cpanel/php/cpanel.php\\";\\r\\n\\r\\n// Print the header\\r\\nheader(\'Content-Type: text/plain\');\\r\\n\\r\\n// Connect to cPanel - only do this once.\\r\\n$cpanel = new CPANEL();\\r\\n\\r\\n// Call the API\\r\\n$response = $cpanel->uapi(\\r\\n    \'SubDomain\',\\r\\n    \'addsubdomain\',\\r\\n    array (\\r\\n        \'domain\' => \'subdomain\',\\r\\n        \'rootdomain\' => \'example.com\',\\r\\n    )\\r\\n);\\r\\n\\r\\n// Handle the response\\r\\nif ($response[\'cpanelresult\'][\'result\'][\'status\']) {\\r\\n    $data = $response[\'cpanelresult\'][\'result\'][\'data\'];\\r\\n    // Do something with the $data\\r\\n    // So you can see the data shape we print it here.\\r\\n    print to_json($data);\\r\\n}\\r\\nelse {\\r\\n    // Report errors:\\r\\n    print to_json($response[\'cpanelresult\'][\'result\'][\'errors\']);\\r\\n}\\r\\n\\r\\n// Disconnect from cPanel - only do this once.\\r\\n$cpanel->end();\\r\\n\\r\\n//--------------------------------------------------------------------------------------\\r\\n// Helper function to convert a PHP value to html printable json\\r\\n//--------------------------------------------------------------------------------------\\r\\nfunction to_json($data) {\\r\\n    return json_encode($data, JSON_PRETTY_PRINT);\\r\\n}\\r\\n```\\r\\n\\r\\n## ***Comment tout \xe7a fonctionne ?***\\r\\n\\r\\nCpanel install\xe9 sur le serveur mutualis\xe9 permet \xe0 l\'utilisateur d\'effectuer toutes les actions qu\'il souhaite.\\r\\n L\'interface Cpanel communique \xe0 travers l\'API pour ex\xe9cuter diff\xe9rentes actions.\\r\\n\\r\\nBeaucoup de param\xe8tres entrent en compte dans le cas d\'un h\xe9bergement mutualis\xe9 car il y a un cloisonnement des autorisations, de la port\xe9e des actions, et des possibilit\xe9s de toucher \xe0 des \xe9l\xe9ments essentiels au fonctionnement de l\'h\xe9bergement.\\r\\n\\r\\nJ\'ai bien \xe9videmment demand\xe9 au service technique de l\'h\xe9bergeur, avant d\'effectuer quoi que ce soit, si l\'utilisation de l\'API n\'allait pas \xe0 l\'encontre de leurs conditions d\'utilisation\\r\\n\\r\\n**Il y \xe0 deux choix qui s\'offrent \xe0 nous:**\\r\\n\\r\\n- Communiquer avec l\'Api en PHP.\\r\\n\\r\\n*Ce qui donnerait:*\\r\\n\\\\\\r\\n**Ma-requete-en-PHP -> UAPI -> CPANEL.**\\r\\n\\r\\n- Utiliser les commandes terminals disponibles.\\r\\n\\r\\n*Ce qui donnerait:*\\r\\n\\\\\\r\\n**Mon code PHP ex\xe9cutant une commande -> Terminal SSH -> UAPI -> CPANEL**\\r\\n\\r\\nS\'agissant la d\'un Proof of Concept, aussi \xe9tonnant que cela puisse para\xeetre, la seconde solution a \xe9t\xe9 la plus intuitive.\\r\\n\\r\\nJ\'ai choisi d\'utiliser les commandes terminal, mais avec l\'id\xe9e en t\xeate d\'utiliser par la suite l\'API en PHP quand j\'aurais \xe9limin\xe9 tous les \xe9l\xe9ments inconnus de la fonctionnalit\xe9.\\r\\nJ\'ai \xe9galement choisi de ne pas utiliser le [Process Component](https://symfony.com/doc/current/components/process.html) de Symfony car il alourdissait mes essais.\\r\\n\\r\\n## ***Clonage du repository Git + Installation des d\xe9pendances (Staging)***\\r\\n\\r\\nC\'est bien beau d\'avoir un sous-domaine, maintenant il faut l\'utiliser !\\r\\n\\r\\nJe me suis cr\xe9\xe9 un petit projet Symfony qui servira de test pour mon staging (cf. : Mon premier objectif).\\r\\nL\'id\xe9e est d\'avoir une interface \xe0 la mani\xe8re d\'Heroku o\xf9 j\'aurais seulement \xe0 indiquer l\'URL de mon repository Git.\\r\\n\\r\\nEn utilisant les commandes shell, j\'ai r\xe9ussi \xe0 me d\xe9brouiller pour cloner le repo puis installer les d\xe9pendances.\\r\\n**La m\xe9thode qui permet le clonage du repository:**\\r\\n\\r\\n```php\\r\\n    /**\\r\\n     * Clones a repository using Git.\\r\\n     *\\r\\n     * @param string $username The username for authentication.\\r\\n     * @param string $token The token for authentication.\\r\\n     * @param string $repositoryUrl The URL of the repository to clone.\\r\\n     * @param string $projectRoot The root directory where the repository will be cloned.\\r\\n     * @return JsonResponse The response containing the output of the clone command.\\r\\n     * @throws InvalidArgumentException If any of the required parameters is empty.\\r\\n     * @throws JsonException If the clone command fails.\\r\\n     */\\r\\n    public function cloneRepo(string $username, string $token, string $repositoryUrl, string $projectRoot): JsonResponse\\r\\n    {\\r\\n        if (empty($username) || empty($token) || empty($repositoryUrl) || empty($projectRoot)) {\\r\\n            throw new InvalidArgumentException(\'Username, token, repository URL or project root is null\');\\r\\n        }\\r\\n        $repositoryUrl = str_replace(\'https://\', \'\', $repositoryUrl);\\r\\n        \\r\\n        $command = sprintf(\'git clone https://%s:%s@%s\', escapeshellarg($username), escapeshellarg($token), escapeshellarg($repositoryUrl));\\r\\n        exec(\\"cd \\" . escapeshellarg($projectRoot) . \\" && $command 2>&1\\", $output, $returnVar);\\r\\n\\r\\n        if ($returnVar !== 0) {\\r\\n            throw new JsonException(implode(\\"\\\\n\\", $output));\\r\\n        }\\r\\n        return new JsonResponse($output);\\r\\n    }\\r\\n```\\r\\n\\r\\n**Puis une methode pour installer les dependances avec composer:**\\r\\n\\r\\n```php\\r\\n    /**\\r\\n     * Install dependencies using Composer.\\r\\n     *\\r\\n     * @param string $homeDir The home directory.\\r\\n     * @param string $projectDir The project directory.\\r\\n     * @return JsonResponse The JSON response containing the output of the Composer installation.\\r\\n     * @throws InvalidArgumentException If the home directory or project directory is empty.\\r\\n     * @throws JsonException If the Composer installation fails.\\r\\n     */\\r\\n    public function installDependencies(string $homeDir, string $projectDir): JsonResponse\\r\\n    {\\r\\n        if (empty($homeDir) || empty($projectDir)) {\\r\\n            throw new InvalidArgumentException(\'Home directory or project directory is null\');\\r\\n        }\\r\\n        putenv(\\"HOME=\\" . escapeshellarg($homeDir));\\r\\n        putenv(\\"COMPOSER_HOME=\\" . escapeshellarg($projectDir));\\r\\n        $composerInstallCommand = \\"cd \\" . escapeshellarg($projectDir) . \\" && \\" . escapeshellarg(self::COMPOSER_ROOT) . \\" install 2>&1\\";\\r\\n\\r\\n        exec($composerInstallCommand, $output, $returnVar);\\r\\n\\r\\n        if ($returnVar !== 0) {\\r\\n            throw new JsonException(implode(\\"\\\\n\\", $output));\\r\\n        }\\r\\n        return new JsonResponse($output);\\r\\n    }\\r\\n```\\r\\n\\r\\n## ***Et pour le CMS ?***\\r\\n\\r\\nBien que je puisse cr\xe9er une s\xe9curit\xe9 suffisante pour \xe9viter la plupart des attaques potentielles depuis l\'app d\'un client,\\r\\nle fait que ce syst\xe8me se trouve sur un h\xe9bergement mutualis\xe9 rend le cloisonnement beaucoup plus complexe.\\r\\n\\r\\nL\'id\xe9e est donc de cr\xe9er des applications ind\xe9pendantes pour chaque nouveau blog d\'utilisateur. Il faut \xe9galement r\xe9fl\xe9chir \xe0 la limitation du nombre de pages, du poids total de l\'app, du type de contenu uploadable, etc.\\r\\n\\r\\nIl existe maintes solutions alternatives possibles pour obtenir une fonctionnalit\xe9 similaire.\\r\\n\\r\\nCependant, pour le d\xe9fi, je tenterai de faire avec les contraintes pr\xe9sent\xe9es, dans un prochain article !\\r\\n\\r\\n## Les actions de l\'api executable en Terminal en cadeau\\r\\n\\r\\n[LA DOC DE L\'API CPANEL COMPLETE ICI :D](https://api.docs.cpanel.net/cpanel/introduction/)\\r\\n\\r\\n<details>\\r\\n<summary>Et les fonctions</summary>\\r\\n\\r\\nThe following calls are available:\\\\\\r\\n\\\\\\r\\nAccountEnhancements::has_enhancement\\\\\\r\\nAccountEnhancements::list\\\\\\r\\nAuditLog::get_api_log\\\\\\r\\nBackup::fullbackup_to_ftp\\\\\\r\\nBackup::fullbackup_to_homedir\\\\\\r\\nBackup::fullbackup_to_scp_with_key\\\\\\r\\nBackup::fullbackup_to_scp_with_password\\\\\\r\\nBackup::list_backups\\\\\\r\\nBackup::restore_databases\\\\\\r\\nBackup::restore_email_filters\\\\\\r\\nBackup::restore_email_forwarders\\\\\\r\\nBackup::restore_files\\\\\\r\\nBandwidth::get_enabled_protocols\\\\\\r\\nBandwidth::get_retention_periods\\\\\\r\\nBandwidth::query\\\\\\r\\nBatch::strict\\\\\\r\\nBlockIP::add_ip\\\\\\r\\nBlockIP::remove_ip\\\\\\r\\nBoxTrapper::blacklist_messages\\\\\\r\\nBoxTrapper::delete_messages\\\\\\r\\nBoxTrapper::deliver_messages\\\\\\r\\nBoxTrapper::get_allowlist\\\\\\r\\nBoxTrapper::get_blocklist\\\\\\r\\nBoxTrapper::get_configuration\\\\\\r\\nBoxTrapper::get_email_template\\\\\\r\\nBoxTrapper::get_forwarders\\\\\\r\\nBoxTrapper::get_ignorelist\\\\\\r\\nBoxTrapper::get_log\\\\\\r\\nBoxTrapper::get_message\\\\\\r\\nBoxTrapper::get_status\\\\\\r\\nBoxTrapper::ignore_messages\\\\\\r\\nBoxTrapper::list_email_templates\\\\\\r\\nBoxTrapper::list_queued_messages\\\\\\r\\nBoxTrapper::process_messages\\\\\\r\\nBoxTrapper::reset_email_template\\\\\\r\\nBoxTrapper::save_configuration\\\\\\r\\nBoxTrapper::save_email_template\\\\\\r\\nBoxTrapper::set_allowlist\\\\\\r\\nBoxTrapper::set_blocklist\\\\\\r\\nBoxTrapper::set_forwarders\\\\\\r\\nBoxTrapper::set_ignorelist\\\\\\r\\nBoxTrapper::set_status\\\\\\r\\nBoxTrapper::whitelist_messages\\\\\\r\\nBranding::get_application_information\\\\\\r\\nBranding::get_applications\\\\\\r\\nBranding::get_available_applications\\\\\\r\\nBranding::get_information_for_applications\\\\\\r\\nBranding::include\\\\\\r\\nCCS::add_delegate\\\\\\r\\nCCS::list_delegates\\\\\\r\\nCCS::list_users\\\\\\r\\nCCS::remove_delegate\\\\\\r\\nCCS::update_delegate\\\\\\r\\nCSVImport::doimport\\\\\\r\\nCacheBuster::read\\\\\\r\\nCacheBuster::update\\\\\\r\\nChkservd::get_exim_ports\\\\\\r\\nChkservd::get_exim_ports_ssl\\\\\\r\\nChrome::get_dom\\\\\\r\\nClamScanner::check_disinfection_status\\\\\\r\\nClamScanner::disinfect_files\\\\\\r\\nClamScanner::get_scan_paths\\\\\\r\\nClamScanner::get_scan_status\\\\\\r\\nClamScanner::list_infected_files\\\\\\r\\nClamScanner::start_scan\\\\\\r\\nContactInformation::set_email_addresses\\\\\\r\\nContactInformation::unset_email_addresses\\\\\\r\\nContactus::is_enabled\\\\\\r\\nDAV::disable_shared_global_addressbook\\\\\\r\\nDAV::enable_shared_global_addressbook\\\\\\r\\nDAV::get_calendar_contacts_config\\\\\\r\\nDAV::has_shared_global_addressbook\\\\\\r\\nDAV::is_ccs_enabled\\\\\\r\\nDAV::is_dav_service_enabled\\\\\\r\\nDAV::is_horde_enabled\\\\\\r\\nDCV::check_domains_via_dns\\\\\\r\\nDCV::check_domains_via_http\\\\\\r\\nDCV::ensure_domains_can_pass_dcv\\\\\\r\\nDNS::ensure_domains_reside_only_locally\\\\\\r\\nDNS::has_local_authority\\\\\\r\\nDNS::lookup\\\\\\r\\nDNS::mass_edit_zone\\\\\\r\\nDNS::parse_zone\\\\\\r\\nDNS::swap_ip_in_zones\\\\\\r\\nDNSSEC::activate_zone_key\\\\\\r\\nDNSSEC::add_zone_key\\\\\\r\\nDNSSEC::deactivate_zone_key\\\\\\r\\nDNSSEC::disable_dnssec\\\\\\r\\nDNSSEC::enable_dnssec\\\\\\r\\nDNSSEC::export_zone_dnskey\\\\\\r\\nDNSSEC::export_zone_key\\\\\\r\\nDNSSEC::fetch_ds_records\\\\\\r\\nDNSSEC::import_zone_key\\\\\\r\\nDNSSEC::remove_zone_key\\\\\\r\\nDNSSEC::set_nsec3\\\\\\r\\nDNSSEC::unset_nsec3\\\\\\r\\nDirectoryIndexes::get_indexing\\\\\\r\\nDirectoryIndexes::list_directories\\\\\\r\\nDirectoryIndexes::set_indexing\\\\\\r\\nDirectoryPrivacy::add_user\\\\\\r\\nDirectoryPrivacy::configure_directory_protection\\\\\\r\\nDirectoryPrivacy::delete_user\\\\\\r\\nDirectoryPrivacy::is_directory_protected\\\\\\r\\nDirectoryPrivacy::list_directories\\\\\\r\\nDirectoryPrivacy::list_users\\\\\\r\\nDirectoryProtection::list_directories\\\\\\r\\nDomainInfo::domains_data\\\\\\r\\nDomainInfo::list_domains\\\\\\r\\nDomainInfo::main_domain_builtin_subdomain_aliases\\\\\\r\\nDomainInfo::single_domain_data\\\\\\r\\nDynamicDNS::create\\\\\\r\\nDynamicDNS::delete\\\\\\r\\nDynamicDNS::list\\\\\\r\\nDynamicDNS::recreate\\\\\\r\\nDynamicDNS::set_description\\\\\\r\\nEA4::get_php_recommendations\\\\\\r\\nEA4::get_recommendations\\\\\\r\\nEmail::account_name\\\\\\r\\nEmail::add_auto_responder\\\\\\r\\nEmail::add_domain_forwarder\\\\\\r\\nEmail::add_forwarder\\\\\\r\\nEmail::add_list\\\\\\r\\nEmail::add_mailman_delegates\\\\\\r\\nEmail::add_mx\\\\\\r\\nEmail::add_pop\\\\\\r\\nEmail::add_spam_filter\\\\\\r\\nEmail::browse_mailbox\\\\\\r\\nEmail::change_mx\\\\\\r\\nEmail::check_fastmail\\\\\\r\\nEmail::count_auto_responders\\\\\\r\\nEmail::count_filters\\\\\\r\\nEmail::count_forwarders\\\\\\r\\nEmail::count_lists\\\\\\r\\nEmail::count_pops\\\\\\r\\nEmail::delete_auto_responder\\\\\\r\\nEmail::delete_domain_forwarder\\\\\\r\\nEmail::delete_filter\\\\\\r\\nEmail::delete_forwarder\\\\\\r\\nEmail::delete_held_messages\\\\\\r\\nEmail::delete_list\\\\\\r\\nEmail::delete_mx\\\\\\r\\nEmail::delete_pop\\\\\\r\\nEmail::disable_filter\\\\\\r\\nEmail::disable_mailbox_autocreate\\\\\\r\\nEmail::disable_spam_assassin\\\\\\r\\nEmail::disable_spam_autodelete\\\\\\r\\nEmail::disable_spam_box\\\\\\r\\nEmail::dispatch_client_settings\\\\\\r\\nEmail::edit_pop_quota\\\\\\r\\nEmail::enable_filter\\\\\\r\\nEmail::enable_mailbox_autocreate\\\\\\r\\nEmail::enable_spam_assassin\\\\\\r\\nEmail::enable_spam_box\\\\\\r\\nEmail::fetch_charmaps\\\\\\r\\nEmail::fts_rescan_mailbox\\\\\\r\\nEmail::generate_mailman_otp\\\\\\r\\nEmail::get_auto_responder\\\\\\r\\nEmail::get_charsets\\\\\\r\\nEmail::get_client_settings\\\\\\r\\nEmail::get_default_email_quota\\\\\\r\\nEmail::get_default_email_quota_mib\\\\\\r\\nEmail::get_disk_usage\\\\\\r\\nEmail::get_filter\\\\\\r\\nEmail::get_held_message_count\\\\\\r\\nEmail::get_lists_total_disk_usage\\\\\\r\\nEmail::get_mailbox_autocreate\\\\\\r\\nEmail::get_mailman_delegates\\\\\\r\\nEmail::get_main_account_disk_usage\\\\\\r\\nEmail::get_main_account_disk_usage_bytes\\\\\\r\\nEmail::get_max_email_quota\\\\\\r\\nEmail::get_max_email_quota_mib\\\\\\r\\nEmail::get_pop_quota\\\\\\r\\nEmail::get_spam_settings\\\\\\r\\nEmail::get_webmail_settings\\\\\\r\\nEmail::has_delegated_mailman_lists\\\\\\r\\nEmail::has_plaintext_authentication\\\\\\r\\nEmail::hold_outgoing\\\\\\r\\nEmail::list_auto_responders\\\\\\r\\nEmail::list_default_address\\\\\\r\\nEmail::list_domain_forwarders\\\\\\r\\nEmail::list_filters\\\\\\r\\nEmail::list_filters_backups\\\\\\r\\nEmail::list_forwarders\\\\\\r\\nEmail::list_forwarders_backups\\\\\\r\\nEmail::list_lists\\\\\\r\\nEmail::list_mail_domains\\\\\\r\\nEmail::list_mxs\\\\\\r\\nEmail::list_pops\\\\\\r\\nEmail::list_pops_with_disk\\\\\\r\\nEmail::list_system_filter_info\\\\\\r\\nEmail::passwd_list\\\\\\r\\nEmail::passwd_pop\\\\\\r\\nEmail::release_outgoing\\\\\\r\\nEmail::remove_mailman_delegates\\\\\\r\\nEmail::reorder_filters\\\\\\r\\nEmail::set_always_accept\\\\\\r\\nEmail::set_default_address\\\\\\r\\nEmail::set_list_privacy_options\\\\\\r\\nEmail::set_manual_mx_redirects\\\\\\r\\nEmail::stats_db_status\\\\\\r\\nEmail::store_filter\\\\\\r\\nEmail::suspend_incoming\\\\\\r\\nEmail::suspend_login\\\\\\r\\nEmail::suspend_outgoing\\\\\\r\\nEmail::terminate_mailbox_sessions\\\\\\r\\nEmail::trace_delivery\\\\\\r\\nEmail::trace_filter\\\\\\r\\nEmail::unset_manual_mx_redirects\\\\\\r\\nEmail::unsuspend_incoming\\\\\\r\\nEmail::unsuspend_login\\\\\\r\\nEmail::unsuspend_outgoing\\\\\\r\\nEmail::verify_password\\\\\\r\\nEmailAuth::disable_dkim\\\\\\r\\nEmailAuth::enable_dkim\\\\\\r\\nEmailAuth::ensure_dkim_keys_exist\\\\\\r\\nEmailAuth::fetch_dkim_private_keys\\\\\\r\\nEmailAuth::install_dkim_private_keys\\\\\\r\\nEmailAuth::install_spf_records\\\\\\r\\nEmailAuth::validate_current_dkims\\\\\\r\\nEmailAuth::validate_current_ptrs\\\\\\r\\nEmailAuth::validate_current_spfs\\\\\\r\\nExternalAuthentication::add_authn_link\\\\\\r\\nExternalAuthentication::configured_modules\\\\\\r\\nExternalAuthentication::get_authn_links\\\\\\r\\nExternalAuthentication::has_external_auth_modules_configured\\\\\\r\\nExternalAuthentication::remove_authn_link\\\\\\r\\nFeatures::get_feature_metadata\\\\\\r\\nFeatures::has_feature\\\\\\r\\nFeatures::list_features\\\\\\r\\nFileman::autocompletedir\\\\\\r\\nFileman::empty_trash\\\\\\r\\nFileman::get_file_content\\\\\\r\\nFileman::get_file_information\\\\\\r\\nFileman::list_files\\\\\\r\\nFileman::save_file_content\\\\\\r\\nFileman::transcode\\\\\\r\\nFileman::upload_files\\\\\\r\\nFtp::add_ftp\\\\\\r\\nFtp::allows_anonymous_ftp\\\\\\r\\nFtp::allows_anonymous_ftp_incoming\\\\\\r\\nFtp::delete_ftp\\\\\\r\\nFtp::ftp_exists\\\\\\r\\nFtp::get_ftp_daemon_info\\\\\\r\\nFtp::get_port\\\\\\r\\nFtp::get_quota\\\\\\r\\nFtp::get_welcome_message\\\\\\r\\nFtp::kill_session\\\\\\r\\nFtp::list_ftp\\\\\\r\\nFtp::list_ftp_with_disk\\\\\\r\\nFtp::list_sessions\\\\\\r\\nFtp::passwd\\\\\\r\\nFtp::server_name\\\\\\r\\nFtp::set_anonymous_ftp\\\\\\r\\nFtp::set_anonymous_ftp_incoming\\\\\\r\\nFtp::set_homedir\\\\\\r\\nFtp::set_quota\\\\\\r\\nFtp::set_welcome_message\\\\\\r\\nGPG::delete_keypair\\\\\\r\\nGPG::export_public_key\\\\\\r\\nGPG::export_secret_key\\\\\\r\\nGPG::generate_key\\\\\\r\\nGPG::import_key\\\\\\r\\nGPG::list_public_keys\\\\\\r\\nGPG::list_secret_keys\\\\\\r\\nImageManager::convert_file\\\\\\r\\nImageManager::create_thumbnails\\\\\\r\\nImageManager::get_dimensions\\\\\\r\\nImageManager::resize_image\\\\\\r\\nIntegration::fetch_url\\\\\\r\\nJetBackup::addQueueDownload\\\\\\r\\nJetBackup::addQueueRestore\\\\\\r\\nJetBackup::addQueueSnapshot\\\\\\r\\nJetBackup::decode_base64\\\\\\r\\nJetBackup::deleteDownload\\\\\\r\\nJetBackup::encode_base64\\\\\\r\\nJetBackup::fileManager\\\\\\r\\nJetBackup::getAccountDetails\\\\\\r\\nJetBackup::getBackupDownloads\\\\\\r\\nJetBackup::getConfigurations\\\\\\r\\nJetBackup::getDownload\\\\\\r\\nJetBackup::getGDPR\\\\\\r\\nJetBackup::getInfo\\\\\\r\\nJetBackup::listBackups\\\\\\r\\nJetBackup::listDownloads\\\\\\r\\nJetBackup::listPermissions\\\\\\r\\nJetBackup::listQueueItems\\\\\\r\\nJetBackup::manageAccount\\\\\\r\\nJetBackup::manageBackup\\\\\\r\\nJetBackup::manageGDPR\\\\\\r\\nJetBackup::unserialize\\\\\\r\\nJetBackup::uri_escape\\\\\\r\\nJetBackup::uri_escape_utf8\\\\\\r\\nJetBackup::uri_unescape\\\\\\r\\nKnownHosts::create\\\\\\r\\nKnownHosts::delete\\\\\\r\\nKnownHosts::update\\\\\\r\\nKnownHosts::verify\\\\\\r\\nLangPHP::php_get_domain_handler\\\\\\r\\nLangPHP::php_get_impacted_domains\\\\\\r\\nLangPHP::php_get_installed_versions\\\\\\r\\nLangPHP::php_get_system_default_version\\\\\\r\\nLangPHP::php_get_vhost_versions\\\\\\r\\nLangPHP::php_ini_get_user_basic_directives\\\\\\r\\nLangPHP::php_ini_get_user_content\\\\\\r\\nLangPHP::php_ini_get_user_paths\\\\\\r\\nLangPHP::php_ini_set_user_basic_directives\\\\\\r\\nLangPHP::php_ini_set_user_content\\\\\\r\\nLangPHP::php_set_vhost_versions\\\\\\r\\nLastLogin::get_last_or_current_logged_in_ip\\\\\\r\\nLocale::get_attributes\\\\\\r\\nLocale::list_locales\\\\\\r\\nLocale::set_locale\\\\\\r\\nLogManager::get_settings\\\\\\r\\nLogManager::list_archives\\\\\\r\\nLogManager::set_settings\\\\\\r\\nMailboxes::expunge_mailbox_messages\\\\\\r\\nMailboxes::expunge_messages_for_mailbox_guid\\\\\\r\\nMailboxes::get_mailbox_status_list\\\\\\r\\nMailboxes::has_utf8_mailbox_names\\\\\\r\\nMailboxes::set_utf8_mailbox_names\\\\\\r\\nMarket::cancel_pending_ssl_certificate\\\\\\r\\nMarket::create_shopping_cart\\\\\\r\\nMarket::create_shopping_cart_non_ssl\\\\\\r\\nMarket::get_all_products\\\\\\r\\nMarket::get_build_cart_url\\\\\\r\\nMarket::get_certificate_status_details\\\\\\r\\nMarket::get_completion_url\\\\\\r\\nMarket::get_license_info\\\\\\r\\nMarket::get_login_url\\\\\\r\\nMarket::get_pending_ssl_certificates\\\\\\r\\nMarket::get_product_info\\\\\\r\\nMarket::get_provider_specific_dcv_constraints\\\\\\r\\nMarket::get_providers_list\\\\\\r\\nMarket::get_ssl_certificate_if_available\\\\\\r\\nMarket::process_ssl_pending_queue\\\\\\r\\nMarket::request_ssl_certificates\\\\\\r\\nMarket::set_status_of_pending_queue_items\\\\\\r\\nMarket::set_url_after_checkout\\\\\\r\\nMarket::validate_login_token\\\\\\r\\nMime::add_handler\\\\\\r\\nMime::add_hotlink\\\\\\r\\nMime::add_mime\\\\\\r\\nMime::add_redirect\\\\\\r\\nMime::delete_handler\\\\\\r\\nMime::delete_hotlink\\\\\\r\\nMime::delete_mime\\\\\\r\\nMime::delete_redirect\\\\\\r\\nMime::get_redirect\\\\\\r\\nMime::list_handlers\\\\\\r\\nMime::list_hotlinks\\\\\\r\\nMime::list_mime\\\\\\r\\nMime::list_redirects\\\\\\r\\nMime::redirect_info\\\\\\r\\nModSecurity::disable_all_domains\\\\\\r\\nModSecurity::disable_domains\\\\\\r\\nModSecurity::enable_all_domains\\\\\\r\\nModSecurity::enable_domains\\\\\\r\\nModSecurity::has_modsecurity_installed\\\\\\r\\nModSecurity::list_domains\\\\\\r\\nMonitoring::create_contact\\\\\\r\\nMonitoring::create_site_monitor\\\\\\r\\nMonitoring::create_site_monitor_shopping_cart\\\\\\r\\nMonitoring::get_all_site_monitors\\\\\\r\\nMonitoring::get_build_cart_url\\\\\\r\\nMonitoring::get_completion_url\\\\\\r\\nMonitoring::get_contact\\\\\\r\\nMonitoring::get_site_monitor\\\\\\r\\nMonitoring::get_store_email_address\\\\\\r\\nMonitoring::get_user_status_from_store\\\\\\r\\nMonitoring::list_contacts\\\\\\r\\nMonitoring::load_user\\\\\\r\\nMonitoring::remove_contact\\\\\\r\\nMonitoring::remove_site_monitor\\\\\\r\\nMonitoring::remove_user\\\\\\r\\nMonitoring::save_user\\\\\\r\\nMonitoring::update_contact\\\\\\r\\nMysql::add_host\\\\\\r\\nMysql::add_host_note\\\\\\r\\nMysql::check_database\\\\\\r\\nMysql::create_database\\\\\\r\\nMysql::create_user\\\\\\r\\nMysql::delete_database\\\\\\r\\nMysql::delete_host\\\\\\r\\nMysql::delete_user\\\\\\r\\nMysql::dump_database_schema\\\\\\r\\nMysql::get_host_notes\\\\\\r\\nMysql::get_privileges_on_database\\\\\\r\\nMysql::get_restrictions\\\\\\r\\nMysql::get_server_information\\\\\\r\\nMysql::list_databases\\\\\\r\\nMysql::list_routines\\\\\\r\\nMysql::list_users\\\\\\r\\nMysql::locate_server\\\\\\r\\nMysql::rename_database\\\\\\r\\nMysql::rename_user\\\\\\r\\nMysql::repair_database\\\\\\r\\nMysql::revoke_access_to_database\\\\\\r\\nMysql::set_password\\\\\\r\\nMysql::set_privileges_on_database\\\\\\r\\nMysql::update_privileges\\\\\\r\\nNVData::get\\\\\\r\\nNVData::set\\\\\\r\\nNginxCaching::clear_cache\\\\\\r\\nNginxCaching::disable_cache\\\\\\r\\nNginxCaching::enable_cache\\\\\\r\\nNginxCaching::reset_cache_config\\\\\\r\\nNotifications::get_notifications_count\\\\\\r\\nParser::firstfile_relative_uri\\\\\\r\\nPassengerApps::disable_application\\\\\\r\\nPassengerApps::edit_application\\\\\\r\\nPassengerApps::enable_application\\\\\\r\\nPassengerApps::ensure_deps\\\\\\r\\nPassengerApps::list_applications\\\\\\r\\nPassengerApps::register_application\\\\\\r\\nPassengerApps::unregister_application\\\\\\r\\nPasswdStrength::get_required_strength\\\\\\r\\nPersonalization::get\\\\\\r\\nPersonalization::set\\\\\\r\\nPlugins::get_uuid\\\\\\r\\nPlugins::reset_uuid\\\\\\r\\nPostgresql::create_database\\\\\\r\\nPostgresql::create_user\\\\\\r\\nPostgresql::delete_database\\\\\\r\\nPostgresql::delete_user\\\\\\r\\nPostgresql::get_restrictions\\\\\\r\\nPostgresql::grant_all_privileges\\\\\\r\\nPostgresql::list_databases\\\\\\r\\nPostgresql::list_users\\\\\\r\\nPostgresql::rename_database\\\\\\r\\nPostgresql::rename_user\\\\\\r\\nPostgresql::rename_user_no_password\\\\\\r\\nPostgresql::revoke_all_privileges\\\\\\r\\nPostgresql::set_password\\\\\\r\\nPostgresql::update_privileges\\\\\\r\\nPushbullet::send_test_message\\\\\\r\\nQuota::get_local_quota_info\\\\\\r\\nQuota::get_quota_info\\\\\\r\\nResellers::list_accounts\\\\\\r\\nResourceUsage::get_usages\\\\\\r\\nRestore::directory_listing\\\\\\r\\nRestore::get_users\\\\\\r\\nRestore::query_file_info\\\\\\r\\nRestore::restore_file\\\\\\r\\nSSH::get_port\\\\\\r\\nSSL::add_autossl_excluded_domains\\\\\\r\\nSSL::can_ssl_redirect\\\\\\r\\nSSL::delete_cert\\\\\\r\\nSSL::delete_csr\\\\\\r\\nSSL::delete_key\\\\\\r\\nSSL::delete_ssl\\\\\\r\\nSSL::disable_mail_sni\\\\\\r\\nSSL::enable_mail_sni\\\\\\r\\nSSL::fetch_best_for_domain\\\\\\r\\nSSL::fetch_cert_info\\\\\\r\\nSSL::fetch_certificates_for_fqdns\\\\\\r\\nSSL::fetch_key_and_cabundle_for_certificate\\\\\\r\\nSSL::find_certificates_for_key\\\\\\r\\nSSL::find_csrs_for_key\\\\\\r\\nSSL::generate_cert\\\\\\r\\nSSL::generate_csr\\\\\\r\\nSSL::generate_key\\\\\\r\\nSSL::get_autossl_excluded_domains\\\\\\r\\nSSL::get_autossl_pending_queue\\\\\\r\\nSSL::get_autossl_problems\\\\\\r\\nSSL::get_cabundle\\\\\\r\\nSSL::get_cn_name\\\\\\r\\nSSL::install_ssl\\\\\\r\\nSSL::installed_host\\\\\\r\\nSSL::installed_hosts\\\\\\r\\nSSL::is_autossl_check_in_progress\\\\\\r\\nSSL::is_mail_sni_supported\\\\\\r\\nSSL::is_sni_supported\\\\\\r\\nSSL::list_certs\\\\\\r\\nSSL::list_csrs\\\\\\r\\nSSL::list_keys\\\\\\r\\nSSL::list_ssl_items\\\\\\r\\nSSL::mail_sni_status\\\\\\r\\nSSL::rebuild_mail_sni_config\\\\\\r\\nSSL::rebuildssldb\\\\\\r\\nSSL::remove_autossl_excluded_domains\\\\\\r\\nSSL::set_autossl_excluded_domains\\\\\\r\\nSSL::set_cert_friendly_name\\\\\\r\\nSSL::set_csr_friendly_name\\\\\\r\\nSSL::set_default_key_type\\\\\\r\\nSSL::set_key_friendly_name\\\\\\r\\nSSL::set_primary_ssl\\\\\\r\\nSSL::show_cert\\\\\\r\\nSSL::show_csr\\\\\\r\\nSSL::show_key\\\\\\r\\nSSL::start_autossl_check\\\\\\r\\nSSL::toggle_ssl_redirect_for_domains\\\\\\r\\nSSL::upload_cert\\\\\\r\\nSSL::upload_key\\\\\\r\\nServerInformation::get_information\\\\\\r\\nServiceProxy::get_service_proxy_backends\\\\\\r\\nServiceProxy::set_service_proxy_backends\\\\\\r\\nServiceProxy::unset_all_service_proxy_backends\\\\\\r\\nSession::create_temp_user\\\\\\r\\nSession::create_webmail_session_for_mail_user\\\\\\r\\nSession::create_webmail_session_for_mail_user_check_password\\\\\\r\\nSession::create_webmail_session_for_self\\\\\\r\\nSiteQuality::create_project\\\\\\r\\nSiteQuality::create_site_quality_user\\\\\\r\\nSiteQuality::delete_site_quality_user\\\\\\r\\nSiteQuality::get_all_scores\\\\\\r\\nSiteQuality::get_app_token\\\\\\r\\nSiteQuality::get_environment\\\\\\r\\nSiteQuality::has_site_quality_user\\\\\\r\\nSiteQuality::is_site_quality_user_enabled\\\\\\r\\nSiteQuality::reset_config\\\\\\r\\nSiteQuality::send_activation_email\\\\\\r\\nSiteQuality::verify_code\\\\\\r\\nSiteTemplates::list_site_templates\\\\\\r\\nSiteTemplates::list_user_settings\\\\\\r\\nSiteTemplates::publish\\\\\\r\\nSitejet::add_api_token\\\\\\r\\nSitejet::create_account\\\\\\r\\nSitejet::create_restore_point\\\\\\r\\nSitejet::create_website\\\\\\r\\nSitejet::disk_quota_check\\\\\\r\\nSitejet::do_not_delete_list\\\\\\r\\nSitejet::get_all_sites_metadata\\\\\\r\\nSitejet::get_all_user_sitejet_info\\\\\\r\\nSitejet::get_api_token\\\\\\r\\nSitejet::get_preview_url\\\\\\r\\nSitejet::get_sitebuilder_domain_statuses\\\\\\r\\nSitejet::get_sso_link\\\\\\r\\nSitejet::get_templates\\\\\\r\\nSitejet::get_user_site_metadata\\\\\\r\\nSitejet::poll_publish\\\\\\r\\nSitejet::publish\\\\\\r\\nSitejet::restore_document_root\\\\\\r\\nSitejet::set_template\\\\\\r\\nSitejet::start_publish\\\\\\r\\nSpamAssassin::clear_spam_box\\\\\\r\\nSpamAssassin::get_symbolic_test_names\\\\\\r\\nSpamAssassin::get_user_preferences\\\\\\r\\nSpamAssassin::update_user_preference\\\\\\r\\nStats::get_bandwidth\\\\\\r\\nStats::get_site_errors\\\\\\r\\nStats::list_sites\\\\\\r\\nStats::list_stats_by_domain\\\\\\r\\nStatsBar::get_stats\\\\\\r\\nStatsManager::get_configuration\\\\\\r\\nStatsManager::save_configuration\\\\\\r\\nSubDomain::addsubdomain\\\\\\r\\nTeam::add_roles\\\\\\r\\nTeam::add_team_user\\\\\\r\\nTeam::edit_team_user\\\\\\r\\nTeam::list_team\\\\\\r\\nTeam::list_team_ui\\\\\\r\\nTeam::remove_roles\\\\\\r\\nTeam::remove_team_user\\\\\\r\\nTeam::set_contact_email\\\\\\r\\nTeam::set_notes\\\\\\r\\nTeam::set_password\\\\\\r\\nTeam::set_roles\\\\\\r\\nTeam::suspend_team_user\\\\\\r\\nTeam::unsuspend_team_user\\\\\\r\\nTeamRoles::list_feature_descriptions\\\\\\r\\nThemes::get_theme_base\\\\\\r\\nThemes::list\\\\\\r\\nThemes::update\\\\\\r\\nTokens::create_full_access\\\\\\r\\nTokens::list\\\\\\r\\nTokens::rename\\\\\\r\\nTokens::revoke\\\\\\r\\nTwoFactorAuth::generate_user_configuration\\\\\\r\\nTwoFactorAuth::get_team_user_configuration\\\\\\r\\nTwoFactorAuth::get_user_configuration\\\\\\r\\nTwoFactorAuth::remove_user_configuration\\\\\\r\\nTwoFactorAuth::set_user_configuration\\\\\\r\\nUserManager::check_account_conflicts\\\\\\r\\nUserManager::create_user\\\\\\r\\nUserManager::delete_user\\\\\\r\\nUserManager::dismiss_merge\\\\\\r\\nUserManager::edit_user\\\\\\r\\nUserManager::list_users\\\\\\r\\nUserManager::lookup_service_account\\\\\\r\\nUserManager::lookup_user\\\\\\r\\nUserManager::merge_service_account\\\\\\r\\nUserManager::unlink_service_account\\\\\\r\\nUserTasks::delete\\\\\\r\\nUserTasks::retrieve\\\\\\r\\nVariables::get_server_information\\\\\\r\\nVariables::get_session_information\\\\\\r\\nVariables::get_user_information\\\\\\r\\nVersionControl::create\\\\\\r\\nVersionControl::delete\\\\\\r\\nVersionControl::retrieve\\\\\\r\\nVersionControl::update\\\\\\r\\nVersionControlDeployment::create\\\\\\r\\nVersionControlDeployment::delete\\\\\\r\\nVersionControlDeployment::retrieve\\\\\\r\\nWebDisk::delete_user\\\\\\r\\nWebDisk::set_homedir\\\\\\r\\nWebDisk::set_password\\\\\\r\\nWebDisk::set_permissions\\\\\\r\\nWebVhosts::list_domains\\\\\\r\\nWebVhosts::list_ssl_capable_domains\\\\\\r\\nWebmailApps::list_webmail_apps\\\\\\r\\nWordPressBackup::any_running\\\\\\r\\nWordPressBackup::cancel\\\\\\r\\nWordPressBackup::cleanup\\\\\\r\\nWordPressBackup::get_available_backups\\\\\\r\\nWordPressBackup::is_running\\\\\\r\\nWordPressBackup::start\\\\\\r\\nWordPressInstanceManager::cancel_scan\\\\\\r\\nWordPressInstanceManager::change_db_password\\\\\\r\\nWordPressInstanceManager::change_user_password\\\\\\r\\nWordPressInstanceManager::check_is_running\\\\\\r\\nWordPressInstanceManager::cleanup_scan\\\\\\r\\nWordPressInstanceManager::configure_autoupdate\\\\\\r\\nWordPressInstanceManager::get_api_version\\\\\\r\\nWordPressInstanceManager::get_instance_by_id\\\\\\r\\nWordPressInstanceManager::get_instances\\\\\\r\\nWordPressInstanceManager::get_latest_wordpress_version_from_wordpress_org\\\\\\r\\nWordPressInstanceManager::get_scan_results\\\\\\r\\nWordPressInstanceManager::is_installable_addon_available\\\\\\r\\nWordPressInstanceManager::start_scan\\\\\\r\\nWordPressManagerDeprecation::is_wptk_installed\\\\\\r\\nWordPressManagerDeprecation::is_wptk_supported\\\\\\r\\nWordPressRestore::any_running\\\\\\r\\nWordPressRestore::cleanup\\\\\\r\\nWordPressRestore::start\\\\\\r\\nWordPressSite::create\\\\\\r\\nWordPressSite::retrieve\\\\\\r\\ncPAddons::get_available_addons\\\\\\r\\ncPAddons::get_instance_settings\\\\\\r\\ncPAddons::list_addon_instances\\\\\\r\\ncPGreyList::disable_all_domains\\\\\\r\\ncPGreyList::disable_domains\\\\\\r\\ncPGreyList::enable_all_domains\\\\\\r\\ncPGreyList::enable_domains\\\\\\r\\ncPGreyList::has_greylisting_enabled\\\\\\r\\ncPGreyList::list_domains\\r\\n\\r\\n</details>"},{"id":"upload-de-fichier-public-ou-non-public-symfony","metadata":{"permalink":"/fr/blog/upload-de-fichier-public-ou-non-public-symfony","source":"@site/blog/01/upload-fichier-public-ou-non-public-symfony/index.md","title":"Upload de fichier - Public ou non public sur Symfony ?","description":"Pourquoi ce questionnement ?","date":"2024-07-09T13:31:15.413Z","tags":[{"inline":false,"label":"symfony","permalink":"/fr/blog/tags/symfony","description":"symfony tag description"},{"inline":false,"label":"security","permalink":"/fr/blog/tags/security","description":"security tag description"},{"inline":false,"label":"component","permalink":"/fr/blog/tags/component","description":"component tag description"}],"readingTime":2.925,"hasTruncateMarker":false,"authors":[{"name":"Boumaza Rayen","title":"D\xe9veloppeur PHP/Symfony | Formateur Passionn\xe9 | Geek \xe0 Plein Temps","url":"https://github.com/RayenBou","imageURL":"https://github.com/RayenBou.png","key":"rayen"}],"frontMatter":{"slug":"upload-de-fichier-public-ou-non-public-symfony","title":"Upload de fichier - Public ou non public sur Symfony ?","authors":"rayen","tags":["symfony","security","component"]},"unlisted":false,"prevItem":{"title":"Cpanel - Une api utilisable m\xeame en acc\xe8s user","permalink":"/fr/blog/une-api-cpanel-utilisable-meme-en-acces-user"}},"content":"## ***Pourquoi ce questionnement ?***\\r\\n\\r\\nJ\'ai \xe9t\xe9 confront\xe9 \xe0 une probl\xe9matique assez particuli\xe8re concernant l\'upload de fichiers sur Symfony.\\r\\n\\r\\nDurant mon apprentissage, il m\'avait \xe9t\xe9 dit il y \xe0 fort longtemps, par un d\xe9veloppeur senior, que l\'upload de fichiers sur Symfony \xe9tait soit dans le dossier public, soit dans le dossier var.\\r\\n\\r\\nJe n\'avais pas attention \xe0 ce d\xe9tail jusqu\'\xe0 il y \xe0 6 mois de cel\xe0.\\r\\n\\r\\nPour le contexte : \xe0 plusieurs reprises, sur des projets clients assez simples, je leurs ai fournis un formulaire pour uploader des images, PDF, Word, etc. et me suis rendu compte du manque de securit\xe9 d\'un upload dans le dossier `/public`.\\r\\n\\r\\nJ\'avais beau retourner la documentation de Symfony ou des bundles, je ne comprenais pas d\'o\xf9 venait le `var/` dont on m\'avait parl\xe9 et quelle utilit\xe9 cela pouvait avoir.\\r\\n\\r\\n[How to upload a file](https://symfony.com/doc/current/controller/upload_file.html).\\r\\n\\r\\n```yaml\\r\\n# config/services.yaml\\r\\n\\r\\n# ...\\r\\nparameters:\\r\\n    brochures_directory: \'%kernel.project_dir%/public/uploads/brochures\'\\r\\n```\\r\\n\\r\\n*Dans le dossier public.*\\r\\n\\r\\n---------\\r\\nCelle de VichUploader\\r\\n\\r\\n[VichUploader](https://github.com/dustin10/VichUploaderBundle/blob/master/docs/usage.md)\\r\\n\\r\\n```yaml\\r\\n# config/packages/vich_uploader.yaml or app/config/config.yml\\r\\nvich_uploader:\\r\\n    db_driver: orm\\r\\n\\r\\n    metadata:\\r\\n        type: attribute\\r\\n\\r\\n    mappings:\\r\\n        products:\\r\\n            uri_prefix: /images/products\\r\\n            upload_destination: \'%kernel.project_dir%/public/images/products\'\\r\\n            namer: Vich\\\\UploaderBundle\\\\Naming\\\\SmartUniqueNamer\\r\\n```\\r\\n\\r\\n*Toujours dans le dossier public.*\\r\\n\\r\\n---------\\r\\n\\r\\n[Upload in Form](https://symfonycasts.com/screencast/symfony-uploads/upload-in-form)\\r\\n\\r\\n```php\\r\\n/** @var UploadedFile $uploadedFile */\\r\\n$uploadedFile = $form[\'imageFile\']->getData();\\r\\n$destination = $this->getParameter(\'kernel.project_dir\').\'/public/uploads/article_image\';\\r\\n```\\r\\n\\r\\n*Encore dans le dossier public ?*\\r\\n\\r\\n## ***Boh \xe7a ne doit pas etre si terrible, si ?***\\r\\n\\r\\n- Postulat :  \\r\\nLe dossier `/public` met \xe0 disposition de mani\xe8re **publique** les ressources.\\r\\n\\r\\n- Question :  \\r\\nLes ressources sont-elles toujours publiques ?\\r\\n\\r\\n- R\xe9ponse :  \\r\\nLes factures d\'un client ne sont certainement pas publiques :D\\r\\n\\r\\nAvec l\'aide de Guillaume (un acolyte dev), nous nous mettons \xe0 la recherche d\'un maximum d\'informations \xe0 ce sujet et nous constatons plusieurs choses :\\r\\n\\r\\nLa d\xe9finition exacte du dossier public implique qu\'il s\'agisse d\'un dossier ne servant qu\'aux ressources statiques.  \\r\\nLes documentations d\'autres frameworks poussent par ailleurs \xe0 uploader les fichiers dans un dossier en dehors du public.\\r\\n\\r\\nIl y a une multitude d\'arguments de s\xe9curit\xe9 qui confirment qu\'on devrait \xe9viter donc l\'upload dans le public au profit d\'un dossier non accessible publiquement. Et dans la logique cloud, une telle pratique permet plus facilement la scalabilit\xe9.\\r\\n\\r\\n**L\'OWASP s\'en m\xeale !**\\r\\n\\r\\n[File Upload Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html)\\r\\n\\r\\n```txt\\r\\nStore the files on a different server. \\r\\nIf that\'s not possible, store them outside of the webroot\\r\\nIn the case of public access to the files, \\r\\nuse a handler that gets mapped to filenames inside the application (someid -> file.ext)\\r\\n```\\r\\n\\r\\nD\'autres articles trouv\xe9s confirment la reflexion:\\r\\n\\r\\n[Why is putting the image folder in the public directory of a web server not secure?](https://www.quora.com/Why-is-putting-the-image-folder-in-the-public-directory-of-a-web-server-not-secure-The-front-controller-should-already-take-care-of-public-folder-security)\\r\\n\\r\\n[Why shouldn\u2019t I upload files in the public directory?](https://forums.meteor.com/t/why-shouldnt-i-upload-files-in-the-public-directory/36899/3)\\r\\n\\r\\n## ***Quel est la solution ?***\\r\\n\\r\\nComment est-il donc possible de servir les ressources sans pour autant compromettre la securit\xe9, tout en ayant un impact minimum sur la modification de la codebase ?\\r\\n\\r\\nTout n\'est pas \xe0 jeter evidemment. La methode `asset()` de twig permet d\'acceder au dossier `/public` qui ne sert **QUE** les ressources statiques du site.\\r\\nPour le reste , ca ira dans le dossier `/var` !\\r\\n\\r\\n**Dans mon services.yaml:**\\r\\n\\r\\n```yaml\\r\\nparameters:\\r\\n    var_file_dir: \\"%kernel.project_dir%/var/upload/\\"\\r\\n```\\r\\n\\r\\n**Dans un Controller:**\\r\\n\\r\\n```php\\r\\n\\r\\n#[Route(\'/file/{folder}/{filename}\', name: \'app_file\', methods: [\'GET\'])]\\r\\npublic function serveFile(string $folder, string $filename): Response\\r\\n{\\r\\n    $baseDir = $this->getParameter(\'var_file_dir\');\\r\\n\\r\\n    $filePath = realpath($baseDir . \'/\' . $folder . \'/\' . $filename);\\r\\n\\r\\n    if (!file_exists($filePath)) {\\r\\n        throw $this->createNotFoundException(\\"the file does not exist.\\");\\r\\n    }\\r\\n\\r\\n    return new BinaryFileResponse($filePath);\\r\\n}\\r\\n```\\r\\n\\r\\n**Dans mon Twig:**\\r\\n\\r\\n```html\\r\\n<img src=\\"{{ path(\'app_file\', {\'folder\': \'gallery\', \'filename\': image.reference}) }}\\">\\r\\n```\\r\\n\\r\\n\\\\\\r\\n\\\\\\r\\n**Ce qui donne une structure comme cel\xe0, \xe0 l\'abri des regards !**\\\\\\r\\n\\\\\\r\\n![Var folder](./img/var-folder.png)"}]}}')}}]);